import r2pipe
import struct

profile = """#!/usr/bin/rarun2
program=./rev_rev_rev
stdin=output
"""
with open('profile.r2','w+') as f:
	print >>f, profile

buf = struct.pack ("31B", *[
0x41,0x29,0xd9,0x65,0xa1,0xf1,0xe1,0xc9,0x19,0x09,0x93,
0x13,0xa1,0x09,0xb9,0x49,0xb9,0x89,0xdd,0x61,0x31,0x69,
0xa1,0xf1,0x71,0x21,0x9d,0xd5,0x3d,0x15,0xd5])
with open('output','w+') as f:
	print >>f, buf


r2=r2pipe.open('./rev_rev_rev')
r2.cmd("e dbg.profile=profile.r2")
r2.cmd("doo")
r2.cmd("db 0x804866D")
r2.cmd("dc")
ciphertext = r2.cmd("pcp 31@ 0x8048870")
print r2.cmd("psz @ (ebp-0x2d)")

# python2 solver.py 2>/dev/null 
